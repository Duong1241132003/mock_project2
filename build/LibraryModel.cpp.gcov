        -:    0:Source:/home/duong/MediaPlayerApp/src/models/LibraryModel.cpp
        -:    0:Graph:/home/duong/MediaPlayerApp/build/CMakeFiles/RunTests.dir/src/models/LibraryModel.cpp.gcno
        -:    0:Data:/home/duong/MediaPlayerApp/build/CMakeFiles/RunTests.dir/src/models/LibraryModel.cpp.gcda
        -:    0:Runs:6
        -:    1:// Project includes
        -:    2:#include "models/LibraryModel.h"
        -:    3:#include "utils/Logger.h"
        -:    4:
        -:    5:// System includes
        -:    6:#include <algorithm>
        -:    7:
        -:    8:namespace media_player 
        -:    9:{
        -:   10:namespace models 
        -:   11:{
        -:   12:
    #####:   13:void LibraryModel::addMedia(const MediaFileModel& media) 
        -:   14:{
        -:   15:    // Check if already exists
    #####:   16:    for (const auto& item : m_mediaList) 
        -:   17:    {
    #####:   18:        if (item.getFilePath() == media.getFilePath()) 
        -:   19:        {
    #####:   20:            return;
        -:   21:        }
        -:   22:    }
        -:   23:    
    #####:   24:    m_mediaList.push_back(media);
    #####:   25:    LOG_DEBUG("Added media to library: " + media.getFileName());
        -:   26:}
        -:   27:
    #####:   28:void LibraryModel::addMediaBatch(const std::vector<MediaFileModel>& mediaList) 
        -:   29:{
    #####:   30:    for (const auto& media : mediaList) 
        -:   31:    {
    #####:   32:        addMedia(media);
        -:   33:    }
    #####:   34:    LOG_INFO("Added " + std::to_string(mediaList.size()) + " items to library");
    #####:   35:}
        -:   36:
    #####:   37:bool LibraryModel::removeMedia(const std::string& filePath) 
        -:   38:{
    #####:   39:    auto it = std::find_if(m_mediaList.begin(), m_mediaList.end(),
    #####:   40:        [&filePath](const MediaFileModel& item) {
    #####:   41:            return item.getFilePath() == filePath;
        -:   42:        });
        -:   43:    
    #####:   44:    if (it != m_mediaList.end()) 
        -:   45:    {
    #####:   46:        LOG_DEBUG("Removed media from library: " + it->getFileName());
    #####:   47:        m_mediaList.erase(it);
    #####:   48:        return true;
        -:   49:    }
        -:   50:    
    #####:   51:    return false;
        -:   52:}
        -:   53:
        -:   54:
    #####:   55:void LibraryModel::clear() 
        -:   56:{
    #####:   57:    m_mediaList.clear();
    #####:   58:    LOG_INFO("Library cleared");
    #####:   59:}
        -:   60:
    #####:   61:bool LibraryModel::updateMedia(const std::string& filePath, const MediaFileModel& updatedMedia) 
        -:   62:{
    #####:   63:    auto it = std::find_if(m_mediaList.begin(), m_mediaList.end(),
    #####:   64:        [&filePath](const MediaFileModel& item) {
    #####:   65:            return item.getFilePath() == filePath;
        -:   66:        });
        -:   67:    
    #####:   68:    if (it != m_mediaList.end()) 
        -:   69:    {
    #####:   70:        *it = updatedMedia;
    #####:   71:        LOG_INFO("Updated media in library: " + updatedMedia.getFileName());
    #####:   72:        return true;
        -:   73:    }
        -:   74:    
    #####:   75:    return false;
        -:   76:}
        -:   77:
    #####:   78:std::optional<MediaFileModel> LibraryModel::getMediaByPath(const std::string& filePath) const 
        -:   79:{
    #####:   80:    for (const auto& media : m_mediaList) 
        -:   81:    {
    #####:   82:        if (media.getFilePath() == filePath) 
        -:   83:        {
    #####:   84:            return media;
        -:   85:        }
        -:   86:    }
    #####:   87:    return std::nullopt;
        -:   88:}
        -:   89:
    #####:   90:std::vector<MediaFileModel> LibraryModel::search(const std::string& query) const 
        -:   91:{
    #####:   92:    std::vector<MediaFileModel> results;
        -:   93:    
    #####:   94:    for (const auto& media : m_mediaList) 
        -:   95:    {
    #####:   96:        if (matchesQuery(media, query)) 
        -:   97:        {
    #####:   98:            results.push_back(media);
        -:   99:        }
        -:  100:    }
        -:  101:    
    #####:  102:    return results;
    =====:  103:}
        -:  104:
    #####:  105:std::vector<MediaFileModel> LibraryModel::getSorted(SortCriteria criteria, bool ascending) const 
        -:  106:{
    #####:  107:    std::vector<MediaFileModel> sorted = m_mediaList;
        -:  108:    
    #####:  109:    auto comparator = [criteria, ascending](const MediaFileModel& a, const MediaFileModel& b) -> bool {
    #####:  110:        bool result = false;
        -:  111:        
    #####:  112:        switch (criteria) 
        -:  113:        {
    #####:  114:            case SortCriteria::TITLE:
        -:  115:            case SortCriteria::FILE_NAME:
    #####:  116:                result = a.getFileName() < b.getFileName();
    #####:  117:                break;
    #####:  118:            case SortCriteria::ARTIST:
        -:  119:            case SortCriteria::ALBUM:
        -:  120:            case SortCriteria::DATE_ADDED:
        -:  121:            default:
    #####:  122:                result = a.getFileName() < b.getFileName();
    #####:  123:                break;
        -:  124:        }
        -:  125:        
    #####:  126:        return ascending ? result : !result;
    #####:  127:    };
        -:  128:    
    #####:  129:    std::sort(sorted.begin(), sorted.end(), comparator);
        -:  130:    
    #####:  131:    return sorted;
    =====:  132:}
        -:  133:
    #####:  134:std::vector<MediaFileModel> LibraryModel::getPage(size_t pageNumber, size_t itemsPerPage) const 
        -:  135:{
    #####:  136:    std::vector<MediaFileModel> page;
        -:  137:    
    #####:  138:    size_t startIndex = pageNumber * itemsPerPage;
        -:  139:    
    #####:  140:    if (startIndex >= m_mediaList.size()) 
        -:  141:    {
    #####:  142:        return page;
        -:  143:    }
        -:  144:    
    #####:  145:    size_t endIndex = std::min(startIndex + itemsPerPage, m_mediaList.size());
        -:  146:    
    #####:  147:    for (size_t i = startIndex; i < endIndex; i++) 
        -:  148:    {
    #####:  149:        page.push_back(m_mediaList[i]);
        -:  150:    }
        -:  151:    
    #####:  152:    return page;
    =====:  153:}
        -:  154:
    #####:  155:int LibraryModel::getTotalAudioFiles() const 
        -:  156:{
    #####:  157:    int count = 0;
    #####:  158:    for (const auto& media : m_mediaList) 
        -:  159:    {
    #####:  160:        if (media.isAudio()) 
        -:  161:        {
    #####:  162:            count++;
        -:  163:        }
        -:  164:    }
    #####:  165:    return count;
        -:  166:}
        -:  167:
    #####:  168:int LibraryModel::getTotalVideoFiles() const 
        -:  169:{
    #####:  170:    int count = 0;
    #####:  171:    for (const auto& media : m_mediaList) 
        -:  172:    {
    #####:  173:        if (media.isVideo()) 
        -:  174:        {
    #####:  175:            count++;
        -:  176:        }
        -:  177:    }
    #####:  178:    return count;
        -:  179:}
        -:  180:
    #####:  181:long long LibraryModel::getTotalSize() const 
        -:  182:{
    #####:  183:    long long totalSize = 0;
    #####:  184:    for (const auto& media : m_mediaList) 
        -:  185:    {
    #####:  186:        totalSize += media.getFileSize();
        -:  187:    }
    #####:  188:    return totalSize;
        -:  189:}
        -:  190:
    #####:  191:bool LibraryModel::matchesQuery(const MediaFileModel& media, const std::string& query) const 
        -:  192:{
    #####:  193:    std::string lowerQuery = query;
    #####:  194:    std::transform(lowerQuery.begin(), lowerQuery.end(), lowerQuery.begin(), ::tolower);
        -:  195:    
    #####:  196:    std::string lowerFileName = media.getFileName();
    #####:  197:    std::transform(lowerFileName.begin(), lowerFileName.end(), lowerFileName.begin(), ::tolower);
        -:  198:    
    #####:  199:    return lowerFileName.find(lowerQuery) != std::string::npos;
    #####:  200:}
        -:  201:
        -:  202:} // namespace models
        -:  203:} // namespace media_player
