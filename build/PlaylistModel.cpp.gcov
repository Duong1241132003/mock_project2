        -:    0:Source:/home/duong/MediaPlayerApp/src/models/PlaylistModel.cpp
        -:    0:Graph:/home/duong/MediaPlayerApp/build/CMakeFiles/RunTests.dir/src/models/PlaylistModel.cpp.gcno
        -:    0:Data:/home/duong/MediaPlayerApp/build/CMakeFiles/RunTests.dir/src/models/PlaylistModel.cpp.gcda
        -:    0:Runs:6
        -:    1:// Project includes
        -:    2:#include "models/PlaylistModel.h"
        -:    3:#include "utils/Logger.h"
        -:    4:
        -:    5:// System includes
        -:    6:#include <algorithm>
        -:    7:#include <random>
        -:    8:#include <sstream>
        -:    9:
        -:   10:namespace media_player 
        -:   11:{
        -:   12:namespace models 
        -:   13:{
        -:   14:
    #####:   15:PlaylistModel::PlaylistModel(const std::string& name)
    #####:   16:    : m_id(generateId())
    #####:   17:    , m_name(name)
    #####:   18:    , m_createdAt(std::chrono::system_clock::now())
    #####:   19:    , m_modifiedAt(std::chrono::system_clock::now())
        -:   20:{
    #####:   21:    LOG_DEBUG("PlaylistModel created: " + name);
    #####:   22:}
        -:   23:
    #####:   24:int PlaylistModel::getTotalDuration() const 
        -:   25:{
        -:   26:    // TODO: Sum durations when metadata is available
    #####:   27:    return 0;
        -:   28:}
        -:   29:
    #####:   30:void PlaylistModel::addItem(const MediaFileModel& media) 
        -:   31:{
    #####:   32:    m_items.push_back(media);
    #####:   33:    m_modifiedAt = std::chrono::system_clock::now();
    #####:   34:    LOG_DEBUG("Added item to playlist: " + media.getFileName());
    #####:   35:}
        -:   36:
    #####:   37:bool PlaylistModel::removeItem(size_t index) 
        -:   38:{
    #####:   39:    if (index >= m_items.size()) 
        -:   40:    {
    #####:   41:        return false;
        -:   42:    }
        -:   43:    
    #####:   44:    m_items.erase(m_items.begin() + index);
    #####:   45:    m_modifiedAt = std::chrono::system_clock::now();
    #####:   46:    return true;
        -:   47:}
        -:   48:
    #####:   49:bool PlaylistModel::removeItem(const std::string& filePath) 
        -:   50:{
    #####:   51:    auto it = std::find_if(m_items.begin(), m_items.end(),
    #####:   52:        [&filePath](const MediaFileModel& item) {
    #####:   53:            return item.getFilePath() == filePath;
        -:   54:        });
        -:   55:    
    #####:   56:    if (it != m_items.end()) 
        -:   57:    {
    #####:   58:        m_items.erase(it);
    #####:   59:        m_modifiedAt = std::chrono::system_clock::now();
    #####:   60:        return true;
        -:   61:    }
        -:   62:    
    #####:   63:    return false;
        -:   64:}
        -:   65:
    #####:   66:void PlaylistModel::clear() 
        -:   67:{
    #####:   68:    m_items.clear();
    #####:   69:    m_modifiedAt = std::chrono::system_clock::now();
    #####:   70:}
        -:   71:
    #####:   72:std::optional<MediaFileModel> PlaylistModel::getItemAt(size_t index) const 
        -:   73:{
    #####:   74:    if (index >= m_items.size()) 
        -:   75:    {
    #####:   76:        return std::nullopt;
        -:   77:    }
    #####:   78:    return m_items[index];
        -:   79:}
        -:   80:
    #####:   81:bool PlaylistModel::moveItem(size_t fromIndex, size_t toIndex) 
        -:   82:{
    #####:   83:    if (fromIndex >= m_items.size() || toIndex >= m_items.size()) 
        -:   84:    {
    #####:   85:        return false;
        -:   86:    }
        -:   87:    
    #####:   88:    MediaFileModel item = m_items[fromIndex];
    #####:   89:    m_items.erase(m_items.begin() + fromIndex);
    #####:   90:    m_items.insert(m_items.begin() + toIndex, item);
    #####:   91:    m_modifiedAt = std::chrono::system_clock::now();
        -:   92:    
    #####:   93:    return true;
    #####:   94:}
        -:   95:
    #####:   96:bool PlaylistModel::containsFile(const std::string& filePath) const 
        -:   97:{
    #####:   98:    return findItemIndex(filePath) >= 0;
        -:   99:}
        -:  100:
    #####:  101:int PlaylistModel::findItemIndex(const std::string& filePath) const 
        -:  102:{
    #####:  103:    for (size_t i = 0; i < m_items.size(); i++) 
        -:  104:    {
    #####:  105:        if (m_items[i].getFilePath() == filePath) 
        -:  106:        {
    #####:  107:            return static_cast<int>(i);
        -:  108:        }
        -:  109:    }
    #####:  110:    return -1;
        -:  111:}
        -:  112:
    #####:  113:std::string PlaylistModel::serialize() const 
        -:  114:{
    #####:  115:    std::stringstream ss;
    #####:  116:    ss << m_id << "|" << m_name << "|" << m_items.size();
        -:  117:    
    #####:  118:    for (const auto& item : m_items) 
        -:  119:    {
    #####:  120:        ss << "|" << item.getFilePath();
        -:  121:    }
        -:  122:    
    #####:  123:    return ss.str();
    #####:  124:}
        -:  125:
    #####:  126:PlaylistModel PlaylistModel::deserialize(const std::string& data) 
        -:  127:{
    #####:  128:    std::stringstream ss(data);
    #####:  129:    std::string token;
        -:  130:    
        -:  131:    // Get ID
    #####:  132:    std::getline(ss, token, '|');
    #####:  133:    std::string id = token;
        -:  134:    
        -:  135:    // Get name
    #####:  136:    std::getline(ss, token, '|');
    #####:  137:    std::string name = token;
        -:  138:    
    #####:  139:    PlaylistModel playlist(name);
        -:  140:    
        -:  141:    // Get count
    #####:  142:    std::getline(ss, token, '|');
        -:  143:    
        -:  144:    // Get items
    #####:  145:    while (std::getline(ss, token, '|')) 
        -:  146:    {
    #####:  147:        if (!token.empty()) 
        -:  148:        {
    #####:  149:            MediaFileModel media(token);
    #####:  150:            if (media.isValid()) 
        -:  151:            {
    #####:  152:                playlist.addItem(media);
        -:  153:            }
    #####:  154:        }
        -:  155:    }
        -:  156:    
    #####:  157:    return playlist;
    #####:  158:}
        -:  159:
    #####:  160:std::string PlaylistModel::generateId() const 
        -:  161:{
    #####:  162:    std::random_device rd;
    #####:  163:    std::mt19937 gen(rd());
    #####:  164:    std::uniform_int_distribution<> dis(0, 15);
        -:  165:    
    #####:  166:    const char* hex = "0123456789abcdef";
    #####:  167:    std::string id;
    #####:  168:    id.reserve(32);
        -:  169:    
    #####:  170:    for (int i = 0; i < 32; i++) 
        -:  171:    {
    #####:  172:        id += hex[dis(gen)];
        -:  173:    }
        -:  174:    
    #####:  175:    return id;
    #####:  176:}
        -:  177:
        -:  178:} // namespace models
        -:  179:} // namespace media_player
