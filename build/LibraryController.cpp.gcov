        -:    0:Source:/home/duong/MediaPlayerApp/src/controllers/LibraryController.cpp
        -:    0:Graph:/home/duong/MediaPlayerApp/build/CMakeFiles/RunTests.dir/src/controllers/LibraryController.cpp.gcno
        -:    0:Data:/home/duong/MediaPlayerApp/build/CMakeFiles/RunTests.dir/src/controllers/LibraryController.cpp.gcda
        -:    0:Runs:6
        -:    1:// Project includes
        -:    2:#include "controllers/LibraryController.h"
        -:    3:#include "utils/Logger.h"
        -:    4:
        -:    5:namespace media_player 
        -:    6:{
        -:    7:namespace controllers 
        -:    8:{
        -:    9:
    #####:   10:LibraryController::LibraryController(
        -:   11:    std::shared_ptr<models::LibraryModel> libraryModel,
        -:   12:    std::shared_ptr<repositories::LibraryRepository> libraryRepo,
        -:   13:    std::shared_ptr<services::IMetadataReader> metadataReader
    #####:   14:)
    #####:   15:    : m_libraryModel(libraryModel)
    #####:   16:    , m_libraryRepo(libraryRepo)
    #####:   17:    , m_metadataReader(metadataReader)
        -:   18:{
    #####:   19:    LOG_INFO("LibraryController initialized");
    #####:   20:}
        -:   21:
    #####:   22:std::optional<models::MetadataModel> LibraryController::readMetadata(const std::string& filePath) const
        -:   23:{
    #####:   24:    if (!m_metadataReader || !m_metadataReader->canReadFile(filePath))
    #####:   25:        return std::nullopt;
    #####:   26:    auto result = m_metadataReader->readMetadata(filePath);
    #####:   27:    if (!result)
    #####:   28:        return std::nullopt;
    #####:   29:    return std::optional<models::MetadataModel>(std::move(*result));
    #####:   30:}
        -:   31:
    #####:   32:bool LibraryController::updateMetadata(const models::MediaFileModel& media, const models::MetadataModel& newMetadata)
        -:   33:{
    #####:   34:    if (!m_metadataReader) return false;
        -:   35:
        -:   36:    // 1. Write to file
    #####:   37:    if (m_metadataReader->writeMetadata(media.getFilePath(), newMetadata)) {
        -:   38:        // 2. Update in-memory model
    #####:   39:        models::MediaFileModel updatedMedia = media;
    #####:   40:        updatedMedia.setTitle(newMetadata.getTitle());
    #####:   41:        updatedMedia.setArtist(newMetadata.getArtist());
    #####:   42:        updatedMedia.setAlbum(newMetadata.getAlbum());
        -:   43:        // updatedMedia.setYear(newMetadata.getYear()); // MediaFileModel might not have year yet? Check MediaFileModel.h
        -:   44:        // updatedMedia.setGenre(newMetadata.getGenre());
        -:   45:        
    #####:   46:        m_libraryModel->updateMedia(media.getFilePath(), updatedMedia);
    #####:   47:        return true;
    #####:   48:    }
    #####:   49:    return false;
        -:   50:}
        -:   51:
    #####:   52:LibraryController::~LibraryController() 
        -:   53:{
    #####:   54:    LOG_INFO("LibraryController destroyed");
    #####:   55:}
        -:   56:
    #####:   57:std::vector<models::MediaFileModel> LibraryController::getAllMedia() const 
        -:   58:{
    #####:   59:    return m_libraryModel->getAllMedia();
        -:   60:}
        -:   61:
    #####:   62:std::vector<models::MediaFileModel> LibraryController::getPage(size_t pageNumber, size_t itemsPerPage) const 
        -:   63:{
    #####:   64:    return m_libraryModel->getPage(pageNumber, itemsPerPage);
        -:   65:}
        -:   66:
    #####:   67:std::vector<models::MediaFileModel> LibraryController::getAudioFiles() const 
        -:   68:{
    #####:   69:    return m_libraryModel->getSorted(models::SortCriteria::FILE_NAME);
        -:   70:}
        -:   71:
    #####:   72:std::vector<models::MediaFileModel> LibraryController::getVideoFiles() const 
        -:   73:{
    #####:   74:    auto allMedia = m_libraryModel->getAllMedia();
    #####:   75:    std::vector<models::MediaFileModel> videoFiles;
        -:   76:    
    #####:   77:    for (const auto& media : allMedia) 
        -:   78:    {
    #####:   79:        if (media.isVideo()) 
        -:   80:        {
    #####:   81:            videoFiles.push_back(media);
        -:   82:        }
        -:   83:    }
        -:   84:    
    #####:   85:    return videoFiles;
    #####:   86:}
        -:   87:
    #####:   88:std::vector<models::MediaFileModel> LibraryController::search(const std::string& query) const 
        -:   89:{
    #####:   90:    return m_libraryModel->search(query);
        -:   91:}
        -:   92:
    #####:   93:std::vector<models::MediaFileModel> LibraryController::sortByTitle(bool ascending) const 
        -:   94:{
    #####:   95:    return m_libraryModel->getSorted(models::SortCriteria::TITLE, ascending);
        -:   96:}
        -:   97:
    #####:   98:std::vector<models::MediaFileModel> LibraryController::sortByArtist(bool ascending) const 
        -:   99:{
    #####:  100:    return m_libraryModel->getSorted(models::SortCriteria::ARTIST, ascending);
        -:  101:}
        -:  102:
    #####:  103:std::vector<models::MediaFileModel> LibraryController::sortByAlbum(bool ascending) const 
        -:  104:{
    #####:  105:    return m_libraryModel->getSorted(models::SortCriteria::ALBUM, ascending);
        -:  106:}
        -:  107:
    #####:  108:size_t LibraryController::getTotalCount() const 
        -:  109:{
    #####:  110:    return m_libraryModel->getMediaCount();
        -:  111:}
        -:  112:
    #####:  113:size_t LibraryController::getAudioCount() const 
        -:  114:{
    #####:  115:    return m_libraryModel->getTotalAudioFiles();
        -:  116:}
        -:  117:
    #####:  118:size_t LibraryController::getVideoCount() const 
        -:  119:{
    #####:  120:    return m_libraryModel->getTotalVideoFiles();
        -:  121:}
        -:  122:
        -:  123:} // namespace controllers
        -:  124:} // namespace media_player
